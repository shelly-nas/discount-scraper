# Discount Scraper Build, Push & Deploy

name: Discount Scraper Build, Push & Deploy

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build:
    uses: ShellyNAS/shared-actions/.github/workflows/build-push.yml@main
    with:
      registry: ${{ vars.REGISTRY_URL }}
      images: |
        [
          {"name": "discount-scraper-db", "context": "database"},
          {"name": "discount-scraper-api", "context": "scraper"},
          {"name": "discount-scraper-web", "context": "web"}
        ]
    secrets:
      registry-username: ${{ vars.REGISTRY_USERNAME }}
      registry-password: ${{ secrets.REGISTRY_PASSWORD }}

  deploy:
    needs: build
    uses: ShellyNAS/shared-actions/.github/workflows/deploy.yml@main
    with:
      registry: ${{ vars.REGISTRY_URL }}
      deploy-directory: /volume1/docker/discount-scraper
      env-variables: |
        DB_NAME=${{ vars.DB_NAME }}
        DB_USER=${{ vars.DB_USER }}
        DB_PASSWORD=${{ secrets.DB_PASSWORD }}
        REGISTRY=${{ vars.REGISTRY_URL }}
        IMAGE_TAG=latest
        LOG_LEVEL=${{ vars.LOG_LEVEL || 'INFO' }}
    secrets:
      registry-username: ${{ vars.REGISTRY_USERNAME }}
      registry-password: ${{ secrets.REGISTRY_PASSWORD }}
